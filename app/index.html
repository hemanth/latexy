<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LaTeXy - AI-Powered LaTeX Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <!-- KaTeX for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <!-- html2pdf for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="/src/style.css">
</head>

<body>
  <div id="app">
    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <a href="/" class="logo">
          <span class="logo-text">LaTeXy</span>
        </a>
      </div>
      <div class="header-center">
        <div class="file-tabs" id="fileTabs">
          <button class="file-tab active" data-file="main.tex">
            <span>main.tex</span>
          </button>
        </div>
      </div>
      <div class="header-right">
        <button class="header-btn" id="settingsBtn" title="API Keys">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path
              d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
      <!-- Left Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-section files-section">
          <div class="section-header">
            <div class="section-header-left">
              <button class="icon-btn" id="sidebarToggle" title="Toggle Sidebar">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" />
                  <line x1="9" y1="3" x2="9" y2="21" />
                </svg>
              </button>
              <span>Files</span>
            </div>
            <button class="icon-btn" id="newFileBtn" title="New File">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14" />
              </svg>
            </button>
          </div>
          <div class="file-tree" id="fileTree">
            <div class="file-item active" data-file="main.tex">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
              </svg>
              <span>main.tex</span>
            </div>
          </div>
        </div>

        <!-- Chat Section -->
        <div class="sidebar-section chat-section" id="chatSection">
          <div class="section-header">
            <span>AI Assistant</span>
            <select id="llmProvider" class="provider-select">
              <option value="openai">OpenAI</option>
              <option value="anthropic">Anthropic</option>
              <option value="gemini">Gemini</option>
              <option value="ollama">Ollama</option>
            </select>
          </div>
          <div class="chat-body" id="chatBody">
            <div class="chat-messages" id="chatMessages">
              <div class="chat-welcome">
                <div class="welcome-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path
                      d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z" />
                    <circle cx="9" cy="13" r="1" />
                    <circle cx="15" cy="13" r="1" />
                    <path d="M9 17h6" />
                  </svg>
                </div>
                <h3>AI Assistant</h3>
                <p>Ask questions about LaTeX, get help with syntax, or request document improvements.</p>
              </div>
            </div>
            <div class="chat-input-container">
              <textarea id="chatInput" placeholder="Ask about LaTeX..." rows="1"></textarea>
              <button class="send-btn" id="sendBtn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </aside>

      <!-- Expand tab (visible when sidebar is collapsed) -->
      <button class="sidebar-expand-tab" id="sidebarExpandTab" title="Expand Sidebar">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 7l5 5-5 5M6 7l5 5-5 5" />
        </svg>
      </button>

      <!-- Editor Panel -->
      <div class="editor-panel" id="editorPanel">
        <div class="panel-toolbar">
          <span class="toolbar-title">Editor</span>
          <div class="toolbar-actions">
            <button class="toolbar-btn" id="packagesBtn" title="Manage Packages">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path
                  d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                <line x1="12" y1="22.08" x2="12" y2="12" />
              </svg>
              Packages
            </button>
            <button class="toolbar-btn" id="formatBtn" title="Format Document">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10H3M21 6H3M21 14H3M21 18H10" />
              </svg>
            </button>
          </div>
        </div>
        <div id="editor"></div>
      </div>

      <!-- Preview Panel -->
      <div class="preview-panel" id="previewPanel">
        <div class="panel-toolbar">
          <div class="toolbar-left">
            <button class="toolbar-btn active" id="previewModeBtn" data-mode="preview">Preview</button>
            <button class="toolbar-btn" id="diffModeBtn" data-mode="diff">Diff</button>
          </div>
          <div class="toolbar-actions">
            <button class="toolbar-btn" id="downloadPdfBtn" title="Download PDF">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
              </svg>
              PDF
            </button>
            <button class="toolbar-btn" id="zoomOutBtn">âˆ’</button>
            <button class="toolbar-btn" id="zoomInBtn">+</button>
          </div>
        </div>
        <div class="preview-content" id="previewContent">
          <div class="latex-output" id="latexOutput"></div>
        </div>
        <div class="diff-content hidden" id="diffContent">
          <div class="diff-header">
            <span class="diff-label original">Original</span>
            <span class="diff-label modified">Modified</span>
          </div>
          <div class="diff-view" id="diffView"></div>
        </div>
      </div>
    </main>

    <!-- Settings Modal -->
    <div class="modal hidden" id="settingsModal">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="modal-close" id="closeSettings">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h3>LLM API Keys</h3>
            <div class="form-group">
              <label for="openaiKey">OpenAI API Key</label>
              <input type="password" id="openaiKey" placeholder="sk-...">
            </div>
            <div class="form-group">
              <label for="anthropicKey">Anthropic API Key</label>
              <input type="password" id="anthropicKey" placeholder="sk-ant-...">
            </div>
            <div class="form-group">
              <label for="geminiKey">Google Gemini API Key</label>
              <input type="password" id="geminiKey" placeholder="AIza...">
            </div>
            <div class="form-group">
              <label for="ollamaUrl">Ollama URL</label>
              <input type="text" id="ollamaUrl" placeholder="http://localhost:11434">
            </div>
          </div>
          <div class="settings-section">
            <h3>Editor</h3>
            <div class="form-group">
              <label>
                <input type="checkbox" id="autoCompile" checked>
                Auto-compile on change
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="syncScroll">
                Sync scroll with preview
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="saveSettings">Save Settings</button>
        </div>
      </div>
    </div>

    <!-- Packages Modal -->
    <div class="modal hidden" id="packagesModal">
      <div class="modal-backdrop"></div>
      <div class="modal-content modal-wide">
        <div class="modal-header">
          <h2>ðŸ“¦ LaTeX Packages</h2>
          <button class="modal-close" id="closePackages">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="package-search">
            <input type="text" id="packageSearch" placeholder="Search packages...">
          </div>
          <div class="package-list" id="packageList">
            <!-- Packages will be rendered here -->
          </div>
          <div class="package-info">
            <p class="package-note">
              <strong>Note:</strong> LaTeX.js (browser renderer) supports a subset of standard LaTeX packages.
              For full package support, export to PDF using a TeX distribution.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>

</html>